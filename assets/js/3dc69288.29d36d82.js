(self.webpackChunksonar_scala=self.webpackChunksonar_scala||[]).push([[201],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,h=d["".concat(l,".").concat(m)]||d[m]||p[m]||o;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},11030:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return i},metadata:function(){return s},toc:function(){return l},default:function(){return c}});var a=n(22122),r=n(19756),o=(n(67294),n(3905)),i={title:"Pull Request Decoration"},s={unversionedId:"setup/pr-decoration",id:"setup/pr-decoration",isDocsHomePage:!1,title:"Pull Request Decoration",description:"Starting from version 7.8.0, sonar-scala can be run in a decoration mode,",source:"@site/docs/setup/pr-decoration.mdx",sourceDirName:"setup",slug:"/setup/pr-decoration",permalink:"/docs/setup/pr-decoration",editUrl:"https://github.com/sonar-scala/website/edit/master/docs/setup/pr-decoration.mdx",version:"current",frontMatter:{title:"Pull Request Decoration"},sidebar:"docs",previous:{title:"sbt-sonar",permalink:"/docs/setup/sbt-sonar"},next:{title:"Scalastyle",permalink:"/docs/rules/scalastyle"}},l=[{value:"Configuration",id:"configuration",children:[]},{value:"Usage",id:"usage",children:[]}],u={toc:l};function c(e){var t=e.components,i=(0,r.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Starting from version ",(0,o.kt)("inlineCode",{parentName:"p"},"7.8.0"),", sonar-scala can be run in a decoration mode,\nwhich can analyse GitHub pull requests and make comments on any new issues\ndirectly on the pull request. Version ",(0,o.kt)("inlineCode",{parentName:"p"},"8.4.0")," and later support\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/enterprise"},"GitHub Enterprise"),"."),(0,o.kt)("p",null,"This functionality is similar to what was provided by the\n",(0,o.kt)("a",{parentName:"p",href:"https://docs.sonarqube.org/display/PLUG/GitHub+Plugin"},"GitHub Plugin"),", which\nwas deprecated in SonarQube 7.2 and replaced by similar functionality in the\npaid Developer Edition. SonarCloud also offers PR decoration, but it requires a\npaid subscription for private projects."),(0,o.kt)("div",{className:"alert alert--info",role:"alert"},"sonar-scala brings Github PR decoration functionality for free to the Community Edition of SonarQube!"),(0,o.kt)("p",null,"See some examples below:"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(40613).Z})),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(45242).Z})),(0,o.kt)("p",null,"sonar-scala also reports a status check at the end of the analysis - passed if\nno critical or blocker issues are found, or failed otherwise."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(65920).Z})),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create a new dedicated Github account (you can use your existing bot/CI\naccount if you already have one)."),(0,o.kt)("li",{parentName:"ul"},"Generate a new personal access token for your account. The token can be\ngenerated in the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/settings/tokens"},"developer settings")," on\nGithub. Select the ",(0,o.kt)("inlineCode",{parentName:"li"},"public_repo")," scope for public repositories or ",(0,o.kt)("inlineCode",{parentName:"li"},"repo")," for\nprivate repositories (or a mix of public and private repositories)."),(0,o.kt)("li",{parentName:"ul"},"Make sure you give your user write permissions to the repositories you want to\ndecorate your PRs for, otherwise sonar-scala will fail as it won't be able to\nset a status of the PR check.")),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("p",null,"Before you execute PR decoration, you need to check out the latest commit of the\nbranch which was used to open the pull request. Once you've done that, you can\nrun sonar-scala in decoration mode by setting the following properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"sonar.scala.pullrequest.provider")," - currently, only ",(0,o.kt)("inlineCode",{parentName:"li"},"github")," is supported"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"sonar.scala.pullrequest.number")," - number of the pull request; if you use\nCircleCI, you can use the ",(0,o.kt)("inlineCode",{parentName:"li"},"CIRCLE_PR_NUMBER")," env variable, Travis has\n",(0,o.kt)("inlineCode",{parentName:"li"},"TRAVIS_PULL_REQUEST")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"sonar.scala.pullrequest.github.repository")," - name of the repository\nincluding organisation name in the following format ",(0,o.kt)("inlineCode",{parentName:"li"},"org/project"),", e.g.\n",(0,o.kt)("inlineCode",{parentName:"li"},"mwz/sonar-scala")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"scala/scala"),", etc."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"sonar.scala.pullrequest.github.oauth")," - Github personal access token that\nyou generated in the previous step")),(0,o.kt)("p",null,"Optional:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"sonar.scala.pullrequest.github.apiurl")," - specify GitHub API url for GitHub\nEnterprise, e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"https://github.mycompany.com/api/v3"),". This property defaults\nto the public GitHub API - ",(0,o.kt)("inlineCode",{parentName:"p"},"https://api.github.com"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"sonar.scala.pullrequest.dryrun"),' - execute PR decoration in "dry run" mode\n(sonar-scala will not post the results to Github). This setting is useful for\ntesting purposes in combination with ',(0,o.kt)("inlineCode",{parentName:"p"},"sonar.verbose=true"),". You usually won't\nneed to use this setting, unless you run into any issues."))),(0,o.kt)("p",null,"Once you run sonar-scala in decoration mode, instead of sending the results to\nSonarQube it will post the relevant comments to Github, which results in\ncreating an empty project in SonarQube. This is necessary to make this feature\nwork since the Community Edition of SonarQube doesn't have the support for\nbranch analysis. sonar-scala works around that limitation by having an empty\nproject so that it can still be executed, analyse your code and post any\ncomments back to Github."),(0,o.kt)("p",null,"You can create an empty project yourself, or you can let sonar-scala do this for\nyou. If your SonarQube instance requires authentication to execute an analysis,\nyou need to make sure that your user has the right permissions to create a new\nproject and execute an analysis, or just the permission to execute analysis if\nyou created a new project yourself. Once you created a new blank project, you\ncan use it across all of your projects."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(4545).Z})),(0,o.kt)("p",null,"The following example shows how to run sonar-scala in decoration mode for pull\nrequest\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/sonar-scala/sonar-scala-pr-annotation-example/pull/1"},"1")," in\nthe\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/sonar-scala/sonar-scala-pr-annotation-example"},"mwz/sonar-scala-pr-annotation-example"),'\nrepository on Github. Notice the project name and key are set to match the\ndedicated blank project in SonarQube, which isn\'t the same project you would\nnormally use to execute an analysis in a "normal" mode.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sbt \\\n  -Dsonar.host.url=http://localhost \\\n  -Dsonar.projectName='PR Decoration' \\\n  -Dsonar.projectKey=pr-decoration \\\n  -Dsonar.scala.pullrequest.provider=github \\\n  -Dsonar.scala.pullrequest.number=1 \\\n  -Dsonar.scala.pullrequest.github.repository=mwz/sonar-scala-pr-annotation-example \\\n  -Dsonar.scala.pullrequest.github.oauth=REDACTED \\\n  sonarScan\n")),(0,o.kt)("p",null,"If you want to have this automated by your CI, which is ideally how it's\nintended to be used, the pull request setting will be different for each pull\nrequest. Most of the modern CI tools allow you to use a built-in environment\nvariable to get the current pull request number - as mentioned previously,\nCircleCI has ",(0,o.kt)("inlineCode",{parentName:"p"},"CIRCLE_PR_NUMBER")," and Travis provides ",(0,o.kt)("inlineCode",{parentName:"p"},"TRAVIS_PULL_REQUEST"),"."),(0,o.kt)("div",{className:"alert alert--warning",role:"alert"},"Please remember that if you use the Scapegoat integration, you still need to generate Scapegoat report before executing sonar-scala otherwise any Scapegoat issues in your project won't be reported back to Github; the same applies to Scoverage."))}c.isMDXComponent=!0},40613:function(e,t,n){"use strict";t.Z=n.p+"assets/images/pr-decoration-example1-b96693acca5df71f59984bbea656ed53.png"},45242:function(e,t,n){"use strict";t.Z=n.p+"assets/images/pr-decoration-example2-4d43624423a3c3e5e07af24ce8fbfa8c.png"},4545:function(e,t,n){"use strict";t.Z=n.p+"assets/images/pr-decoration-sonarqube-5badae0adf551da82e89574f8eb7d702.png"},65920:function(e,t,n){"use strict";t.Z=n.p+"assets/images/pr-decoration-status-check-be5589a1948757d11717ca4ee3f565bd.png"}}]);